## My work

Variational Auto-Encoding (VAE, 变分自编码器)

VAE和GAN (Generative Adversarial Network, 对抗生成网络) 的目标是基本一致的，

即模型希望构建一个从隐变量$Z$生成目标数据$X$的模型，都是属于生成式的模型



以数学的形式来说：

1. 首先假设隐变量$Z$服从某些常见的分布（先验分布），例如
   - 正态分布
   - 均匀分布
2. 训练一个模型$\hat X=g(Z)$
3. 使得该模型能够和原来的概率分布映射倒训练集的概率分布，目标是进行分布之间的变换

![1](./assert/my_work/1.png)

而生成式的模型的难题在于如何判断生成分布和真实分布的相似度，因为我们只知道两者采样的结果，而**不知道他们的分布表达式**

我们只有从先验分布中采样并通过模型得到的一批数据$\hat X$以及从真实数据中采样而来的一批数据$X$，但是我们并不知道他们的分布表达式，所以这里不能使用KL散度来刻画概率分布之间的差异。



但是VAE和GAN采用了不同的策略：

- GAN的思路是，无法找到适合的度量，我们就训练一个神经网络来代替这个度量，这个神经网络就被称为判别器。因此GAN不仅需要训练一个生成器也需要训练一个判别器，所以其训练过程较难，也有使用Wasserstein GAN (W-GAN)利用Wasserstein 距离的角度来对GAN优化的模型。
- 而VAE则采用了另外一种技巧，即根据样本获取分布，并且采用了贝叶斯公式



首先，我们进行问题定义，假设我们有一批数据样本$X_1,...,X_n$，整体用$X$来表示，我们希望利用$X1,..,X_n$得到$X$的分布$p(X)$，如果可以实现，那便是一个最理想的情况。

在VAE中采用的是另外一种形式，我们首先先利用条件概率公式对$p(X)$进行修改，
$$
p(X)=\int p(X|Z)p(Z)dz
$$
即利用一个$p(X|Z)$来描述由$Z$来生成$X$的模型，而对于$p(Z)$，我们假设$Z$服从标准正态分布$\N(0,1)$



![2](./assert/my_work/2.png)



但是，我们并不清楚经过重新采样出来的$Z_i$是否还对应着原来的$X_i$，所以我们直接最小化它们之间的距离是有问题的。



在VAE的模型中，我们没有使用先验分布是正态分布的假设，我们用的是假设$p(Z|X)$是正态分布：

即，给定一个真实样本$X_i$，我们假设存在一个**专属**于$X_i$的分布$p(Z|X_i)$，并且假设该分布是**正态分布**。



为什么？

如果我们假设$p(Z)$是正态分布，然后从$p(Z)$中采样一个$Z$，那么我们并不知道该$Z$对应哪个真实的$X$。而现在我们假设$P(Z|X_i)$是$X_i$的专属后验分布，则我们有理由说采样出来的$Z_i$应该要还原到$X_k$中去



因此，此时每一个$X_i$都分配上了一个专属的正态分布。但是这样的话，有多少个$X$就有多少个正态分布了，我们知道正态分布有两组参数

- 均值$\mu$
- 方差$\sigma^2$



那么，对于每个$X_i$，我们如何找出其专属正态分布$p(Z|X_i)$的均值和方差呢？

在这里，由于我们无法直接求出他的均值和方差，所以我们直接用神经网络来代替。

对于难算的一些东西，我们都倾向于利用神经网络来进行拟合，例如WGAN中的判别器。



于是，我们构建了两个神经网络$\mu_i=f_1(X_i)$，$log\sigma_i^2 = f_2(X_i)$来计算均值和方差，需要强调的是，这里我们选择拟合$\log\sigma^2_i$而不是直接$\sigma^2$是因为方差总是非负的，需要利用激活函数处理，而加上log后不需要激活函数，因为他们可正可负。



到此，我们已经知道专属的$X_i$的均值和方差了，也就是知道它的正态分布长什么样了，然后从这个专属分布中采样一个$Z_k$出来，然后经过一个生成器得到$\hat X_i=g(Z_k)$；这样我们就可以最小化$D(\hat X_i,X_i)$了，因为他们是一一对应的。

![3](./assert/my_work/3.png)



实际上，VAE就是为每个样本构造专属的正态分布，然后采样来重构



分表标准化的过程：

在重构的过程中会收到噪声的影响，**因为$Z_i$是通过重新采样过的，不是直接由encode计算得到的**。

显然噪声会增加重构的难度，但是这个噪声的强度是通过神经网络计算出来的，所以最终模型为了重构的更好，则肯定会想办法让方差为0。然后，方差为0后，就没有随机性了，所以不管如何采样其实都是只能得到确定的结果。



故，VAE还会让所有的后验分布$p(Z|X)$都逼近于标准正态分布，这样就

1. 防止了噪声为0的问题，因为标准正态分布的方差为1

2. 保证了模型的生成能力

   根据定义：$p(Z)=\sum_Xp(Z|X)P(X)=\sum_X \N(0,1)p(X)=\N(0,1)\sum_Xp(X)=\N(0,1)$

   所以$p(Z)$是标准正态分布。



![4](./assert/my_work/4.png)



那么，如何将后验分布$p(Z|X)$对齐$\N(0,1)$呢？

我们利用KL散度来进行逼近，将后验分布逼近于标准正态分布。



KL散度：














